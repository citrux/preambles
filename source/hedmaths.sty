\NeedsTeXFormat{LaTeX2e}[1995/06/01]
\ProvidesPackage{hedmaths}[2013/10/18 v0.1.9]

\newif\if@complex
\newif\if@derivative
\newif\if@shortcuts
\newif\if@environments
\newif\if@vectors
\newif\if@root

\@complexfalse
\@derivativefalse
\@shortcutsfalse
\@environmentsfalse
\@vectorsfalse
\@rootfalse

% работа с комплексными числами
\DeclareOption{complex}{%
    \@complextrue
}

% производные и дифференциал
\DeclareOption{derivative}{%
    \@derivativetrue
}

% упрощение набора пределов
\DeclareOption{shortcuts}{%
    \@shortcutstrue
}

\DeclareOption{environments}{%
    \@environmentstrue
}

\DeclareOption{vectors}{%
    \@vectorstrue
}

% закрывающийся символ корня
\DeclareOption{root}{
    \@roottrue
}

\ExecuteOptions{derivative}
\ProcessOptions

% --- обозначения и команды ---
\newcommand{\const}{\mathrm{const}}                       % константа
\newcommand{\average}[1]{\left\langle {#1} \right\rangle} % обозначение среднего
\newcommand{\abs}[1]{\left|\,\!{#1}\,\!\right|}           % обозначение модуля
% xxx обозначения и команды xxx

% --- подключаемые пакеты ---
\RequirePackage[intlimits,sumlimits,namelimits,centertags]{amsmath}
\RequirePackage{amssymb}
\RequirePackage{wasysym}
\RequirePackage{multirow} % зачем он здесь? не математика же
\RequirePackage{array}
% xxx подключаемые пакеты xxx

% --- переобозначение символов ---
\let\oldphi\phi \let\phi\varphi \let\varphi\oldphi             %   phi <-> varphi
\let\oldtheta\theta \let\theta\vartheta \let\vartheta\oldtheta % theta <-> vartheta
\let\oldkappa\kappa \let\kappa\varkappa \let\varkappa\oldkappa % kappa <-> varkappa
\let\oldGamma\Gamma \let\Gamma\varGamma \let\varGamma\oldGamma % Gamma <-> varGamma
\let\eps\varepsilon                                        % varepsilon -> eps
\let\le\leqslant                                           %   leqslant -> le
\let\ge\geqslant                                           %   geqslant -> ge
\let\leqflat\leq \let\leq\leqslant           % leq -> leqflat; leqslant -> leq
\let\geqflat\geq \let\geq\geqslant           % geq -> geqflat; geqslant -> geq
% xxx переобозначение символов xxx

\if@complex
    \let\varRe\Re \let\Re\mathbf{Re\,} % Re -> varRe; bf{Re} -> Re
    \let\varIm\Im \let\Im\mathbf{Im\,} % Im -> varIm; bf{Im} -> Im
\fi

\if@derivative
    \renewcommand{\d}{\, d} % может стоит использовать \d для обозначения \partial?
    \newcommand{\pder}[2]{\frac{\partial #1}{\partial #2}}
    \newcommand{\ppder}[2]{\frac{\partial^2 #1}{\partial #2^2}}
    \newcommand{\pcder}[3]{\frac{\partial^2 #1}{\partial #2 \partial #3}}
    \newcommand{\der}[2]{\frac{d #1}{d #2}}
    \newcommand{\dder}[2]{\frac{d^2 #1}{d #2^2}}
\fi

\if@shortcuts
    \newcommand{\limni}{\lim_{n\to\infty}}
    \newcommand{\lni}{\limits_0^\infty}
    \newcommand{\lii}{\limits_{-\infty}^\infty}
\fi

\if@environments
    \RequirePackage{amsthm}
    \newtheorem{theorem}{Теорема}
    \newtheorem{lemma}{Лемма}
    \newtheorem{proposition}{Утверждение}
    \newtheorem{corollary}{Следствие}
    \renewenvironment{proof}[1][Доказательство.]
        {\begin{trivlist}\item[\hskip \labelsep {\bfseries #1}]
        \setlength{\parindent}{0cm}}
        {\end{trivlist}\hrulefill}
    \newenvironment{solution}[1][Решение.]
        {\begin{trivlist}\item[\hskip \labelsep {\bfseries #1}]
        \setlength{\parindent}{0cm}}
        {\end{trivlist}\hrulefill}
    \newenvironment{definition}[1][Определение.]
        {\begin{quote}\begin{trivlist}\item[\hskip \labelsep {\bfseries #1}]}
        {\end{trivlist}\end{quote}}
    \newenvironment{remark}[1][Замечание.]
        {\begin{quote}\begin{trivlist}\item[\hskip \labelsep {\bfseries #1}]}
        {\end{trivlist}\end{quote}}
    \newtheorem{comment}{Комментарий}[section]
    \newtheorem{example}{Пример}[section]
    \ifx\appendix\undefined
      \newenvironment{appendix}[1][Приложение.]
        {\begin{trivlist}\item[\hskip \labelsep {\bfseries #1}]
        \setlength{\parindent}{0cm}}
        {\end{trivlist}}
    \else
      \renewenvironment{appendix}[1][Приложение.]
        {\begin{trivlist}\item[\hskip \labelsep {\bfseries #1}]
        \setlength{\parindent}{0cm}}
        {\end{trivlist}}
    \fi
    \newenvironment{conclusion}{\itshape}{}
\fi

\if@vectors
    \newcommand{\divergence}{\mathrm{div\,}}
    \newcommand{\gradient}{\mathrm{grad\,}}
    \newcommand{\rotor}{\mathrm{rot\,}}
\fi

\if@root
    \RequirePackage{letltxmacro}
    \let\oldr@@t\r@@t
    \def\r@@t#1#2{%
    \setbox0=\hbox{$\oldr@@t#1{#2\,}$}\dimen0=\ht0
    \advance\dimen0-0.2\ht0
    \setbox2=\hbox{\vrule height\ht0 depth -\dimen0}%
    {\box0\lower0.4pt\box2}}
    \LetLtxMacro{\varsqrt}{\sqrt}
    \renewcommand*{\sqrt}[2][\ ]{\varsqrt[#1]{#2}}
\fi
